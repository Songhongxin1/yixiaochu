<?phpif (!defined('BASEPATH')) exit('No direct script access allowed');/** * 菜品表 * @author chaokai@gz-zc.cn */class Model_foods extends MY_Model{        private $_table = 't_foods';        public function __construct(){                parent::__construct($this->_table);                $this->load->model(array(        	'Model_admins' => 'Madmins'        ));    }        /**     * 列表及总条数     * @author chaokai@gz-zc.cn     */    public function get_list($where = array(), $pagesize = 0, $offset = 0, $order_by = array()){        $default_where = array('is_del' => 0);        $where = array_merge($default_where, $where);        !$pagesize && $pagesize = C('page.config.per_page');                $count = $this->count($where);                $field = 'id,foods_name,cover_img,old_price,now_price,sort,type,sell_number,is_show,is_today';        $list = $this->get_lists($field, $where, $order_by, $pagesize, $offset);                //获取分类        $this->load->model('Model_foods_type', 'Mfoods_type');        $foods_type = $this->Mfoods_type->get_list();        $foods_type = array_column($foods_type, 'name', 'id');                //处理图片链接及其他数据        foreach ($list as $k => $v){            $list[$k]['cover_img'] = get_full_img_url($v['cover_img']);            $list[$k]['type'] = $foods_type[$v['type']];            if($v['is_today']){                $list[$k]['is_today_text'] = '今日菜品';            }else{                $list[$k]['is_today_text'] = '他日菜品';            }            if($v['is_show']){                $list[$k]['is_show_text'] = '是';            }else{                $list[$k]['is_show_text'] = '否';            }        }                return array('count' => $count, 'list' => $list);    }        /**     * 获取详情     * @author chaokai@gz-zc.cn     */    public function get_info($id){      $info = $this->get_one('*', array('id' => $id));      if($info){        $info['cover_img_url'] = get_full_img_url($info['cover_img']);      }      //管理员信息      $ids = array($info['update_admin'], $info['create_admin']);      $admins_info = $this->Madmins->get_lists('id,fullname', array('in' => array('id' => $ids)));      foreach ($admins_info as $k => $v){        if($v['id'] == $info['update_admin']){          $info['update_admin_text'] = $v['fullname'];        }        if($v['id'] == $info['create_admin']){          $info['create_admin_text'] = $v['fullname'];        }      }      //分类      $type = $this->Mfoods_type->get_one('id,name', array('id' => $info['type']));      $info['type_text'] = $type['name'];            return $info;    }        /**     * 修改某个字段的值     * @author cahokai@gz-zc.nc     */    public function set($id, $data){      return $this->update_info($data, array('id' => $id));    }        /**     * 根据id数组获取列表信息     * @author chaokai@gz-zc.cn     */    public function get_list_by_ids($ids, $is_moble = false){      $field = 'id,foods_name,old_price,now_price,cover_img';      if($is_moble){          $field = 'id, foods_name, cover_img, description, food_material, nutritive_value, sell_number, like_num';      }      $where = array('in' => array('id' => $ids));      $list = $this->get_lists($field, $where);      foreach ($list as $k => $v){          $list[$k]['cover_img'] = get_full_img_url($v['cover_img']);      }      return $list;    }}