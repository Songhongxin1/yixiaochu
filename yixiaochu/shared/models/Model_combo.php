<?phpif (!defined('BASEPATH')) exit('No direct script access allowed');/** * 套餐表 * @author chaokai@gz-zc.cn * */class Model_combo extends MY_Model{        private $_table = 't_combo';        public function __construct(){                parent::__construct($this->_table);                $this->load->model(array(        	'Model_foods' => 'Mfoods'        ));    }        /**     * 获取详情     * @author chaokai@gz-zc.cn     */    public function get_info($id){      $field = 'id,combo_cate_id,combo_name,description,cover_img,relevance_id,price,favorable,sell_number';      $info = $this->get_one($field, array('id' => $id));            if(!$info){        return false;      }            $foods_ids = explode(',', $info['relevance_id']);      $foods_list = $this->Mfoods->get_list_by_ids($foods_ids);            return array('info' => $info, 'foods' => $foods_list);    }        /**     * 根据id列表获取详情     * @author chaokai@gz-zc.cn     */    public function get_info_by_ids($ids, $is_moble = false){      $field = 'id,combo_cate_id,combo_name,description,cover_img,relevance_id,price,favorable,sell_number';      $info_list = $this->get_lists($field, array('in' => array('id' => $ids)));            if(!$info_list){        return false;      }      //在每条套餐记录中增加菜品数组      foreach ($info_list as $k => $v){        $info_list[$k]['relevance_ids'] = explode(',', $v['relevance_id']);        $info_list[$k]['cover_img'] = get_full_img_url($v['cover_img']);      }      //合并所有菜品id      $foods_ids = array();      foreach ($info_list as $k => $v){        $foods_ids = array_unique(array_merge(explode(',', $v['relevance_id']), $foods_ids));      }      //查询菜品信息      $foods_list = $this->Mfoods->get_list_by_ids($foods_ids, $is_moble);            foreach ($info_list as $k => $v){        foreach ($foods_list as $key => $value){          if(in_array($value['id'], $v['relevance_ids'])){            $info_list[$k]['foods'][] = $value;          }        }      }      return $info_list;    }}